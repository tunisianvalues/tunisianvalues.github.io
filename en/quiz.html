<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TunisianValues — Quiz</title>
    <link rel="icon" type="image/png" href="../icon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styless.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'oswald': ['Oswald', 'sans-serif']
                    }
                }
            }
        }
    </script>
</head>

<body class="font-oswald antialiased">
    <script type="application/javascript" src="questions.js"></script>
    <div class="min-h-screen bg-gradient-to-br from-red-600 to-red-700 flex flex-col">
        <header class="border-b border-red-500/30 bg-red-600/90 backdrop-blur-sm">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <img src="../TUNISIAN VALUES.png" alt="TunisianValues logo" class="h-10 w-auto">
                    </div>
                </div>
            </div>
        </header>

        <div class="min-h-screen bg-gradient-to-br from-red-600 to-red-700 flex flex-col justify-center items-center px-4 py-8">
            <main class="w-full max-w-3xl">
                <div class="bg-white/95 backdrop-blur-sm rounded-xl p-6 md:p-10 shadow-2xl">
                    <div class="text-center mb-6">
                        <h2 id="question-number" class="text-xl font-semibold text-red-600 tracking-wider">Loading...</h2>
                    </div>

                    <p id="question-text" class="text-2xl md:text-3xl font-bold text-gray-800 text-center mb-8 min-h-[120px] flex items-center justify-center"></p>

                    <div class="space-y-3 mb-8">
                        <button class="w-full text-lg font-bold py-4 px-6 rounded-lg transition-transform duration-200 ease-in-out transform hover:scale-105 shadow-md bg-green-700 hover:bg-green-800 text-white" onclick="next_question(1.0)">Strongly Agree</button>
                        <button class="w-full text-lg font-bold py-3 px-6 rounded-lg transition-transform duration-200 ease-in-out transform hover:scale-105 shadow-md bg-green-500 hover:bg-green-600 text-white" onclick="next_question(0.5)">Agree</button>
                        <button class="w-full text-lg font-bold py-3 px-6 rounded-lg transition-transform duration-200 ease-in-out transform hover:scale-105 shadow-md bg-gray-400 hover:bg-gray-500 text-white" onclick="next_question(0.0)">Neutral / Mixed</button>
                        <button class="w-full text-lg font-bold py-3 px-6 rounded-lg transition-transform duration-200 ease-in-out transform hover:scale-105 shadow-md bg-red-500 hover:bg-red-600 text-white" onclick="next_question(-0.5)">Disagree</button>
                        <button class="w-full text-lg font-bold py-4 px-6 rounded-lg transition-transform duration-200 ease-in-out transform hover:scale-105 shadow-md bg-red-700 hover:bg-red-800 text-white" onclick="next_question(-1.0)">Strongly Disagree</button>
                    </div>

                    <div class="text-center">
                        <button id="back_button" onclick="prev_question()" class="text-gray-600 hover:text-red-700 font-semibold py-2 px-5 rounded-lg transition-colors">← Back</button>
                        <button id="back_button_off" class="text-gray-400 font-semibold py-2 px-5 rounded-lg cursor-not-allowed">← Back</button>
                    </div>
                </div>
            </main>
        </div>

        <script>
            // Shuffle ensuring we don't lose the ID reference
            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }
            shuffle(questions);

            var max_pana = 0,
                max_coop = 0,
                max_econ = 0,
                max_reli = 0,
                max_soci = 0,
                max_demo = 0,
                max_decent = 0;

            // Arrays to calculate bar scores
            let pana_array = new Array(questions.length).fill(0);
            let coop_array = new Array(questions.length).fill(0);
            let econ_array = new Array(questions.length).fill(0);
            let reli_array = new Array(questions.length).fill(0);
            let soci_array = new Array(questions.length).fill(0);
            let demo_array = new Array(questions.length).fill(0);
            let decent_array = new Array(questions.length).fill(0);

            // Neutral arrays
            let neutral_pana_array = new Array(questions.length).fill(0);
            let neutral_coop_array = new Array(questions.length).fill(0);
            let neutral_econ_array = new Array(questions.length).fill(0);
            let neutral_reli_array = new Array(questions.length).fill(0);
            let neutral_soci_array = new Array(questions.length).fill(0);
            let neutral_demo_array = new Array(questions.length).fill(0);
            let neutral_decent_array = new Array(questions.length).fill(0);

            // Store answers by ID for the advanced result logic
            let answers_map = {};

            var qn = 0;

            for (var i = 0; i < questions.length; i++) {
                max_pana += Math.abs(questions[i].effect.pana || 0);
                max_coop += Math.abs(questions[i].effect.coop || 0);
                max_econ += Math.abs(questions[i].effect.econ || 0);
                max_reli += Math.abs(questions[i].effect.reli || 0);
                max_soci += Math.abs(questions[i].effect.soci || 0);
                max_demo += Math.abs(questions[i].effect.demo || 0);
                max_decent += Math.abs(questions[i].effect.decent || 0);
            }

            function init_question() {
                document.getElementById("question-text").innerHTML = questions[qn].question;
                document.getElementById("question-number").innerHTML = "Question " + (qn + 1) + " of " + questions.length;
                if (qn === 0) {
                    document.getElementById("back_button").style.display = 'none';
                    document.getElementById("back_button_off").style.display = 'block';
                } else {
                    document.getElementById("back_button").style.display = 'block';
                    document.getElementById("back_button_off").style.display = 'none';
                }
            }

            init_question();

            function next_question(mult) {
                // Map the specific answer to the question ID
                if (questions[qn].id) {
                    answers_map[questions[qn].id] = mult;
                }

                // Standard scoring logic for the bars
                if (mult === 0.0) {
                    pana_array[qn] = 0;
                    coop_array[qn] = 0;
                    econ_array[qn] = 0;
                    reli_array[qn] = 0;
                    soci_array[qn] = 0;
                    demo_array[qn] = 0;
                    decent_array[qn] = 0;

                    neutral_pana_array[qn] = Math.abs(questions[qn].effect.pana || 0);
                    neutral_coop_array[qn] = Math.abs(questions[qn].effect.coop || 0);
                    neutral_econ_array[qn] = Math.abs(questions[qn].effect.econ || 0);
                    neutral_reli_array[qn] = Math.abs(questions[qn].effect.reli || 0);
                    neutral_soci_array[qn] = Math.abs(questions[qn].effect.soci || 0);
                    neutral_demo_array[qn] = Math.abs(questions[qn].effect.demo || 0);
                    neutral_decent_array[qn] = Math.abs(questions[qn].effect.decent || 0);
                } else {
                    pana_array[qn] = mult * (questions[qn].effect.pana || 0);
                    coop_array[qn] = mult * (questions[qn].effect.coop || 0);
                    econ_array[qn] = mult * (questions[qn].effect.econ || 0);
                    reli_array[qn] = mult * (questions[qn].effect.reli || 0);
                    soci_array[qn] = mult * (questions[qn].effect.soci || 0);
                    demo_array[qn] = mult * (questions[qn].effect.demo || 0);
                    decent_array[qn] = mult * (questions[qn].effect.decent || 0);

                    neutral_pana_array[qn] = 0;
                    neutral_coop_array[qn] = 0;
                    neutral_econ_array[qn] = 0;
                    neutral_reli_array[qn] = 0;
                    neutral_soci_array[qn] = 0;
                    neutral_demo_array[qn] = 0;
                    neutral_decent_array[qn] = 0;
                }

                qn++;
                if (qn < questions.length) {
                    init_question();
                } else {
                    results();
                }
            }

            function prev_question() {
                if (qn === 0) return;
                qn--;
                init_question();
            }

            function results() {
                let final_pana = pana_array.reduce((a, b) => a + b, 0);
                let final_coop = coop_array.reduce((a, b) => a + b, 0);
                let final_econ = econ_array.reduce((a, b) => a + b, 0);
                let final_reli = reli_array.reduce((a, b) => a + b, 0);
                let final_soci = soci_array.reduce((a, b) => a + b, 0);
                let final_demo = demo_array.reduce((a, b) => a + b, 0);
                let final_decent = decent_array.reduce((a, b) => a + b, 0);

                let final_n_pana = neutral_pana_array.reduce((a, b) => a + b, 0);
                let final_n_coop = neutral_coop_array.reduce((a, b) => a + b, 0);
                let final_n_econ = neutral_econ_array.reduce((a, b) => a + b, 0);
                let final_n_reli = neutral_reli_array.reduce((a, b) => a + b, 0);
                let final_n_soci = neutral_soci_array.reduce((a, b) => a + b, 0);
                let final_n_demo = neutral_demo_array.reduce((a, b) => a + b, 0);
                let final_n_decent = neutral_decent_array.reduce((a, b) => a + b, 0);

                // Special icons logic
                let special_icons = [];
                for (let i = 0; i < questions.length; i++) {
                    if (questions[i].special && answers_map[questions[i].id] > 0) {
                        special_icons.push(questions[i].special);
                    }
                }
                const icons_param = special_icons.join(',');

                // Compress answers for URL
                let ans_str = "";
                for (let key in answers_map) {
                    // simple serialization: key:val,key:val
                    ans_str += key + ":" + answers_map[key] + ",";
                }
                // Remove trailing comma
                ans_str = ans_str.slice(0, -1);

                // Construct URL
                location.href = `results.html` +
                    `?s_pana=${final_pana}&n_pana=${final_n_pana}&m_pana=${max_pana}` +
                    `&s_coop=${final_coop}&n_coop=${final_n_coop}&m_coop=${max_coop}` +
                    `&s_econ=${final_econ}&n_econ=${final_n_econ}&m_econ=${max_econ}` +
                    `&s_reli=${final_reli}&n_reli=${final_n_reli}&m_reli=${max_reli}` +
                    `&s_soci=${final_soci}&n_soci=${final_n_soci}&m_soci=${max_soci}` +
                    `&s_demo=${final_demo}&n_demo=${final_n_demo}&m_demo=${max_demo}` +
                    `&s_decent=${final_decent}&n_decent=${final_n_decent}&m_decent=${max_decent}` +
                    `&icons=${icons_param}` +
                    `&ans=${encodeURIComponent(ans_str)}`;
            }
        </script>
</body>


</html>

